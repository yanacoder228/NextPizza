generator client {
   provider = "prisma-client-js"
}

datasource db {
   provider = "postgresql"
   url      = env("DATABASE_URL")
}

model User {
   id Int @id @default(autoincrement())

   fullName String @map("full_name")
   email    String @unique()
   password String

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt @map("updated_at")
   Cart      Cart?    @relation("user_cart")
   cartId    Int

   @@map("users")
}

model Product {
   id Int @id @default(autoincrement())

   title      String
   imgUrl     String    @map("img_url")
   category   Category? @relation("product_category", fields: [categoryId], references: [id])
   categoryId Int?

   ingredient       Ingredient[]       @relation("product_ingredients")
   productVariation ProductVariation[] @relation("product_variations")

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt @map("updated_at")

   @@map("products")
}

model ProductVariation {
   id        Int  @id @default(autoincrement())
   price     Int
   size      Int?
   pizzaType Int? @map("pizza_type")

   product   Product @relation("product_variations", fields: [productId], references: [id])
   productId Int

   createdAt DateTime   @default(now()) @map("created_at")
   updatedAt DateTime   @updatedAt @map("updated_at")
   CartItem  CartItem[] @relation("product_item")

   @@map("product_variations")
}

model Category {
   id Int @id @default(autoincrement())

   title    String    @unique()
   products Product[] @relation("product_category")

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt @map("updated_at")

   @@map("categories")
}

model Ingredient {
   id Int @id @default(autoincrement())

   title  String @unique()
   price  Int
   imgUrl String

   products Product[] @relation("product_ingredients")

   createdAt  DateTime  @default(now()) @map("created_at")
   updatedAt  DateTime  @updatedAt @map("updated_at")
   CartItem   CartItem? @relation(fields: [cartItemId], references: [id])
   cartItemId Int?

   @@map("ingredients")
}

model Cart {
   id Int @id @default(autoincrement())

   userCart User? @relation("user_cart", fields: [userId], references: [id])
   userId   Int?  @unique

   totalAmount Int     @default(0)
   token       String?

   CartItem CartItem[] @relation("user_cart")

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt @map("updated_at")

   @@map("carts")
}

model CartItem {
   id Int @id @default(autoincrement())

   userCart Cart @relation("user_cart", fields: [cartId], references: [id])
   cartId   Int

   productItem        ProductVariation @relation("product_item", fields: [productVariationId], references: [id])
   productVariationId Int              @map("product_variation_id")

   ingredients Ingredient[]

   quantity Int @default(1)

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt @map("updated_at")

   @@map("cart_item")
}
