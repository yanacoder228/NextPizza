generator client {
   provider = "prisma-client-js"
}

datasource db {
   provider = "postgresql"
   url      = env("DATABASE_URL")
}

model User {
   id       Int    @id @default(autoincrement())
   fullName String @map("full_name")
   email    String @unique()
   password String

   cart   Cart @relation(fields: [cartId], references: [id])
   cartId Int

   orders Order[]

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt @map("updated_at")

   @@map("users")
}

model Category {
   id       Int       @id @default(autoincrement())
   title    String    @unique()
   products Product[] @relation("product_category")

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt @map("updated_at")

   @@map("categories")
}

model Product {
   id         Int       @id @default(autoincrement())
   title      String
   imgUrl     String    @map("img_url")
   category   Category? @relation("product_category", fields: [categoryId], references: [id])
   categoryId Int?

   ingredients Ingredient[]       @relation("product_ingredients")
   variations  ProductVariation[] @relation("product_variations")

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt @map("updated_at")

   @@map("products")
}

model ProductVariation {
   id        Int  @id @default(autoincrement())
   price     Int
   size      Int?
   pizzaType Int? @map("pizza_type")

   product   Product @relation("product_variations", fields: [productId], references: [id])
   productId Int

   cartItems  CartItem[]
   orderItems OrderItem[]

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt @map("updated_at")

   @@map("product_variations")
}

model Ingredient {
   id     Int    @id @default(autoincrement())
   title  String @unique()
   price  Int
   imgUrl String

   products   Product[]   @relation("product_ingredients")
   cartItems  CartItem[]
   orderItems OrderItem[]

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt @map("updated_at")

   @@map("ingredients")
}

model Cart {
   id          Int     @id @default(autoincrement())
   user        User    @relation(fields: [userId], references: [id])
   totalAmount Int     @default(0)
   token       String?

   items CartItem[]

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt @map("updated_at")
   userId    Int

   @@map("carts")
}

model CartItem {
   id     Int  @id @default(autoincrement())
   cart   Cart @relation(fields: [cartId], references: [id])
   cartId Int

   productVariation   ProductVariation @relation(fields: [productVariationId], references: [id])
   productVariationId Int

   ingredients Ingredient[]
   quantity    Int          @default(1)

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt
}

model Order {
   id     Int   @id @default(autoincrement())
   user   User? @relation(fields: [userId], references: [id])
   userId Int?

   token       String
   totalAmount Int         @default(0) @map("total_amount")
   status      OrderStatus
   paymentId   String?

   items OrderItem[]

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt
}

model OrderItem {
   id      Int   @id @default(autoincrement())
   order   Order @relation(fields: [orderId], references: [id])
   orderId Int

   productVariation   ProductVariation @relation(fields: [productVariationId], references: [id])
   productVariationId Int

   ingredients Ingredient[]
   quantity    Int          @default(1)
   priceAtBuy  Int

   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt
}

enum OrderStatus {
   PENDING
   CANCELLED
   SUCCEEDED
}
